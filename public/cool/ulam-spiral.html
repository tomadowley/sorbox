<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ulam Prime Spiral — Cool Demo</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #131a2a;
      --text: #d7e1ff;
      --muted: #7f8db3;
      --accent: #6cf1ff;
      --prime: #9bff9b;
      --composite: #25304f;
      --grid: #1a2238;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }

    .wrap { display: grid; grid-template-rows: auto 1fr; height: 100%; }

    header { position: sticky; top: 0; z-index: 2; background: linear-gradient(180deg, rgba(19,26,42,.96), rgba(19,26,42,.82)); border-bottom: 1px solid var(--grid); backdrop-filter: blur(8px); }
    .bar { display: flex; gap: 12px; align-items: center; padding: 12px 16px; flex-wrap: wrap; }
    .title { font-weight: 700; letter-spacing: 0.2px; margin-right: 6px; }
    .spacer { flex: 1; }

    label { display: inline-flex; align-items: center; gap: 8px; color: var(--muted); font-size: 14px; }
    input[type="number"], select { background: var(--bg); color: var(--text); border: 1px solid var(--grid); border-radius: 8px; padding: 8px 10px; font-size: 14px; width: 110px; }
    input[type="color"] { background: transparent; border: none; width: 28px; height: 28px; padding: 0; }

    button { appearance: none; background: var(--accent); color: #04262b; border: none; border-radius: 10px; padding: 10px 14px; font-weight: 700; box-shadow: 0 6px 20px rgba(108,241,255,.25), inset 0 -2px 0 rgba(0,0,0,.15); cursor: pointer; transition: transform .04s ease; }
    button:active { transform: translateY(1px); }
    button.secondary { background: #2d3b5e; color: var(--text); box-shadow: inset 0 -2px 0 rgba(0,0,0,.2); }

    main { position: relative; }
    canvas { display: block; width: 100%; height: 100%; background: radial-gradient(1200px 800px at 20% 10%, #0f1630, #0b1020 60%); }

    .fps { position: absolute; left: 12px; bottom: 12px; background: rgba(11,16,32,.65); border: 1px solid var(--grid); padding: 6px 10px; border-radius: 8px; font-size: 12px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="bar">
        <div class="title">Ulam Prime Spiral</div>
        <label>Points <input id="points" type="number" min="1000" step="1000" value="50000" /></label>
        <label>Step(px) <input id="step" type="number" min="1" max="20" value="3" /></label>
        <label>Mode
          <select id="mode">
            <option value="animate">Animate</option>
            <option value="instant">Instant</option>
          </select>
        </label>
        <label>Prime <input id="primeColor" type="color" value="#9bff9b" /></label>
        <label>Composite <input id="compositeColor" type="color" value="#25304f" /></label>
        <button id="draw">Draw</button>
        <button id="reset" class="secondary">Reset</button>
        <div class="spacer"></div>
        <div class="title" style="opacity:.65;font-weight:600">A little math art ✨</div>
      </div>
    </header>
    <main>
      <canvas id="c"></canvas>
      <div class="fps" id="fps">0 fps</div>
    </main>
  </div>

  <script>
    // Basic prime test (sufficient for visualization scales)
    function isPrime(n) {
      if (n < 2) return false;
      if (n % 2 === 0) return n === 2;
      if (n % 3 === 0) return n === 3;
      const r = Math.floor(Math.sqrt(n));
      for (let f = 5; f <= r; f += 6) {
        if (n % f === 0 || n % (f + 2) === 0) return false;
      }
      return true;
    }

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d', { alpha: false });
    const pointsEl = document.getElementById('points');
    const stepEl = document.getElementById('step');
    const modeEl = document.getElementById('mode');
    const primeColorEl = document.getElementById('primeColor');
    const compositeColorEl = document.getElementById('compositeColor');
    const fpsEl = document.getElementById('fps');

    let W = 0, H = 0, cx = 0, cy = 0;

    function resize() {
      const rect = canvas.parentElement.getBoundingClientRect();
      W = Math.max(200, Math.floor(rect.width));
      H = Math.max(200, Math.floor(rect.height));
      const ratio = window.devicePixelRatio || 1;
      canvas.width = Math.floor(W * ratio);
      canvas.height = Math.floor(H * ratio);
      canvas.style.width = W + 'px';
      canvas.style.height = H + 'px';
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      cx = Math.floor(W / 2);
      cy = Math.floor(H / 2);
    }

    window.addEventListener('resize', () => {
      const snapshot = ctx.getImageData(0, 0, canvas.width, canvas.height);
      resize();
      ctx.putImageData(snapshot, 0, 0);
    });

    resize();

    function clearCanvas() {
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg');
      ctx.fillRect(0, 0, W, H);
    }

    function* spiral(step) {
      // Generates coordinates in a square spiral: (0,0), (1,0), (1,1), (0,1), (-1,1), ...
      let x = 0, y = 0, len = 1;
      const dirs = [ [1,0], [0,-1], [-1,0], [0,1] ]; // E, N, W, S (screen y grows down, hence -1 for up)
      yield [x, y];
      while (true) {
        for (let i = 0; i < 4; i++) {
          const [dx, dy] = dirs[i];
          const steps = (i < 2) ? len : len + 1; // lengths: 1,1,2,2,3,3,...
          for (let s = 0; s < steps; s++) {
            x += dx; y += dy;
            yield [x, y];
          }
        }
        len += 2; // after completing E,N,W,S, side length increases by 2
      }
    }

    function drawPoint(ix, iy, step, isPrimeVal, primeColor, compositeColor) {
      const x = cx + ix * step;
      const y = cy + iy * step;
      if (x < 0 || y < 0 || x >= W || y >= H) return;
      if (step <= 2) {
        // single pixel for dense plots
        ctx.fillStyle = isPrimeVal ? primeColor : compositeColor;
        ctx.fillRect(x, y, 1, 1);
      } else {
        const size = Math.max(1, Math.floor(step * 0.8));
        const off = Math.floor((step - size) / 2);
        ctx.fillStyle = isPrimeVal ? primeColor : compositeColor;
        ctx.fillRect(x - off, y - off, size, size);
      }
    }

    function drawInstant(total, step, primeColor, compositeColor) {
      clearCanvas();
      ctx.imageSmoothingEnabled = false;
      const gen = spiral(step);
      let n = 1;
      for (let i = 0; i < total; i++) {
        const [ix, iy] = gen.next().value;
        drawPoint(ix, iy, step, isPrime(n), primeColor, compositeColor);
        n++;
      }
    }

    function drawAnimated(total, step, primeColor, compositeColor) {
      clearCanvas();
      ctx.imageSmoothingEnabled = false;
      const gen = spiral(step);
      let n = 1;
      let drawn = 0;

      // Simple fps estimation
      let last = performance.now();
      let frames = 0;

      function frame() {
        const now = performance.now();
        frames++;
        if (now - last >= 500) {
          const fps = Math.round(frames * 1000 / (now - last));
          fpsEl.textContent = `${fps} fps`;
          frames = 0; last = now;
        }

        // Draw in batches per animation frame for speed
        let batch = Math.min(500, total - drawn);
        while (batch-- > 0) {
          const { value } = gen.next();
          const [ix, iy] = value;
          drawPoint(ix, iy, step, isPrime(n), primeColor, compositeColor);
          n++; drawn++;
        }
        if (drawn < total) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    document.getElementById('draw').addEventListener('click', () => {
      const total = Math.max(1000, parseInt(pointsEl.value, 10) || 50000);
      const step = Math.max(1, Math.min(40, parseInt(stepEl.value, 10) || 3));
      const primeColor = primeColorEl.value || '#9bff9b';
      const compositeColor = compositeColorEl.value || '#25304f';
      modeEl.value === 'instant' ?
        drawInstant(total, step, primeColor, compositeColor) :
        drawAnimated(total, step, primeColor, compositeColor);
    });

    document.getElementById('reset').addEventListener('click', () => {
      clearCanvas();
    });

    // First paint (subtle grid background)
    clearCanvas();
    ctx.strokeStyle = 'rgba(255,255,255,.04)';
    for (let x = 0; x < W; x += 40) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, H); ctx.stroke(); }
    for (let y = 0; y < H; y += 40) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(W, y); ctx.stroke(); }
  </script>
</body>
</html>
